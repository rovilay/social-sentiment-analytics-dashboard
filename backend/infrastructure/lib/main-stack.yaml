Parameters:
  BucketName:
    Type: String
    Description: Unique name for the S3 bucket
    Default: tweet-sentiment-analytics-74f90b7a-236a-4d62
  BucketURL:
    Type: String
    Description: S3 bucket URL
    Default: https://tweet-sentiment-analytics-74f90b7a-236a-4d62.s3.us-east-1.amazonaws.com
  TwitterAPISecret:
    Type: String
    Description: Twitter credentials
    Default: arn:aws:secretsmanager:us-east-1:122610488400:secret:tweet-sentiment-twitter-api-keys-jTbDmL

Resources:  
  DataCollectionFunctionStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - ${BucketURL}/infrastructure/data-collection-function.yaml
        - BucketURL: !Ref BucketURL
      Parameters:
        BucketName: !Ref BucketName
        TwitterAPISecret: !Ref TwitterAPISecret

  EventBridgeRuleStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - ${BucketURL}/infrastructure/eventbridge-rule.yaml
        - BucketURL: !Ref BucketURL
    DependsOn:
      - DataCollectionFunctionStack
  
  DynamoDBTableStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - ${BucketURL}/infrastructure/dynamodb-table.yaml
        - BucketURL: !Ref BucketURL

  KinesisDataStreamStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - ${BucketURL}/infrastructure/kinesis-data-stream.yaml
        - BucketURL: !Ref BucketURL
  
  SentimentAnalysisFunctionStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub
        - ${BucketURL}/infrastructure/sentiment-analysis-function.yaml
        - BucketURL: !Ref BucketURL
      Parameters:
        BucketName: !Ref BucketName
    DependsOn:
      - DynamoDBTableStack
      - KinesisDataStreamStack
